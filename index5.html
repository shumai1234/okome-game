<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThisYear'sIncome</title>
    <link rel="stylesheet" href="assets/commonStyle.css">
    <link rel="stylesheet" href="assets/style5.css">
</head>
<body>

    <h1 id="thisYear">今年の決算</h1>
    <h2 id="income"></h2>
    <h2 id="expense"></h2>
    <h2 id="total"></h2>
    <h3 id="result"></h3>
    <div id="last">
    <img src="assets/images/riceGod.PNG" alt="米神">
    <button id="nextYear">次年度の挑戦に移る</button>
    </div>
    <script>
       
    // 数値への変換
    const totalSales = Number(localStorage.getItem('totalSales'));
    const totalExpense = Number(localStorage.getItem('totalExpense'));
    const profit = totalSales - totalExpense;

    // 年度管理
    const year = Number(localStorage.getItem('year'));
    document.getElementById('thisYear').textContent = `第${year}年度の決算`;

    //サウンド管理
    const resultSound = new Audio ('assets/sounds/buyingSound.mp3');
    function resultSoundPlay() {
        resultSound.pause();
        resultSound.currentTime = 0;
        resultSound.play();
    }

    //効果音とともに決算発表をするためのコード
    setTimeout(()=>{
    resultSoundPlay();
    document.getElementById('income').textContent = `今年度の総合売り上げは${totalSales}円でした。`;
    income.style.opacity = 1;
      },500);
     timerId = setTimeout(()=>{
    resultSoundPlay();
    document.getElementById('expense').textContent = `今年度の総仕入れ額は${totalExpense}円でした。`;
    expense.style.opacity = 1;
       },1500);
     timerId = setTimeout(()=>{
        resultSoundPlay();
    document.getElementById('total').textContent = `今年度の最終利益は${profit}円でした。`;
    total.style.opacity = 1;
       },2500);
    timerId = setTimeout(()=>{
        resultSoundPlay();
    if (profit >= 0) {
       
        document.getElementById('result').textContent = `おめでとうございます！今年度は黒字経営でした！`;
    } else {

        document.getElementById('result').textContent = `残念ながら今年度は赤字経営でした。来年度に期待しましょう。`;
    }
    },3500);
    
    
    document.getElementById('nextYear').onclick = function() {
        // 重要：過去の合計利益を取得（最初は0）
    let totalProfit = Number(localStorage.getItem('totalProfit')) || 0;

    // 今回の利益を合計に加算
    totalProfit = totalProfit + profit; 

    // 重要：加算した結果を保存
    localStorage.setItem('totalProfit', totalProfit);





        if (year < 3) {
            location.href = 'index2.html';
        } else {
            // 3年終わったら年度をリセット
            localStorage.setItem('year', 0);
            location.href = 'index6.html';
        }
    };

    </script>
</body>
</html>